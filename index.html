<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>â˜¯ï¸æ­¦è¡“èª²â˜¯ï¸ç°½åˆ°ç³»çµ±ğŸ«¸ğŸ¤›</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #2c2f33, #23272a);
      color: #eee;
      min-height: 100vh;
    }
    h2 {
      color: #f1c40f; /* é‡‘é»ƒ */
      text-shadow: 1px 1px 3px #b22222;
      text-align: center;
      font-size: 28px;
      margin-bottom: 10px;
    }
    .top-controls {
      margin-bottom: 12px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      background-color: #fdf6e3; /* æ·ºé‡‘è‰²èƒŒæ™¯ */
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      color: #222;
    }
    .top-controls label {
      font-weight: bold;
    }
    .top-controls select,
    .top-controls input {
      border: 2px solid #b22222;
      border-radius: 8px;
      padding: 6px 12px;
      font-size: 16px;
      outline: none;
      transition: border-color 0.3s ease;
      color: #222;
    }
    .top-controls select:focus,
    .top-controls input:focus {
      border-color: #8b1a1a;
    }
    .top-controls button {
      background-color: #b22222;
      color: white;
      border: none;
      padding: 8px 16px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .top-controls button:hover {
      background-color: #8b1a1a;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background-color: #fefefe;
      color: #222;
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: center;
      font-size: 14px;
    }
    .signed {
      background: #b2f2bb;
    }
    .warning {
      color: red;
      font-weight: bold;
      white-space: pre-line;
    }
    .admin-btn {
      background-color: #b22222;
      color: white;
      border: none;
      padding: 6px 10px;
      cursor: pointer;
      border-radius: 8px;
      transition: background-color 0.3s ease;
    }
    .admin-btn:hover {
      background-color: #8b1a1a;
    }
    .delete-btn {
      background-color: #b22222;
      color: white;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 12px;
      border-radius: 6px;
      transition: background-color 0.3s ease;
    }
    .delete-btn:hover {
      background-color: #8b1a1a;
    }
    .pagination {
      margin-top: 12px;
      text-align: center;
    }
    .pagination button {
      padding: 6px 14px;
      margin: 0 6px;
      font-size: 15px;
      background-color: #b22222;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .pagination button:hover {
      background-color: #8b1a1a;
    }
    #totalCount {
      font-weight: bold;
      margin-left: auto;
      color: #222;
    }
  </style>
</head>
<body>
  <h2>â˜¯ï¸æ­¦è¡“èª²â˜¯ï¸ç°½åˆ°ç³»çµ±ğŸ«¸ğŸ¤›</h2>
  <div class="top-controls">
    <label for="year">é¸æ“‡å¹´ä»½ï¼š</label>
    <select id="year"></select>
    <label for="month">é¸æ“‡æœˆä»½ï¼š</label>
    <select id="month"></select>
    <input type="text" id="studentName" placeholder="æ–°å¢å­¸ç”Ÿ">
    <button onclick="addStudent()">æ–°å¢</button>
    <button id="clearBtn" class="admin-btn" style="display:none;" onclick="clearAll()">å…¨éƒ¨åˆªé™¤</button>
    <button id="exitBtn" class="admin-btn" style="display:none;" onclick="exitAdmin()">é›¢é–‹ç®¡ç†æ¨¡å¼</button>
    <span id="totalCount"></span>
  </div>
  <table>
    <thead>
      <tr>
        <th>ç·¨è™Ÿ<br>å§“å</th>
        <th id="d1">ç¬¬ä¸€é€±æ—¥<br>-</th>
        <th id="d2">ç¬¬äºŒé€±æ—¥<br>-</th>
        <th id="d3">ç¬¬ä¸‰é€±æ—¥<br>-</th>
        <th id="d4">ç¬¬å››é€±æ—¥<br>-</th>
        <th id="d5">ç¬¬äº”é€±æ—¥<br>-</th>
        <th>ç¹³è²»<br>è£œå ‚</th>
        <th>å‰©é¤˜<br>å ‚æ•¸</th>
        <th>ç´¯ç©<br>å ‚æ•¸</th>
        <th id="delCol" style="display:none;">åˆªé™¤</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
  <div class="pagination">
    <button onclick="prevPage()">ä¸Šä¸€é </button>
    <span id="pageInfo">ç¬¬ 1 / 1 é </span>
    <button onclick="nextPage()">ä¸‹ä¸€é </button>
  </div>

  <script>
    const yearSelect = document.getElementById("year");
    const monthSelect = document.getElementById("month");
    const tableBody = document.getElementById("tableBody");
    const studentInput = document.getElementById("studentName");
    const clearBtn = document.getElementById("clearBtn");
    const exitBtn = document.getElementById("exitBtn");
    const totalCountEl = document.getElementById("totalCount");
    const pageInfo = document.getElementById("pageInfo");
    let students = JSON.parse(localStorage.getItem("students")) || [];
    let records = JSON.parse(localStorage.getItem("records")) || {};
    let creditMap = JSON.parse(localStorage.getItem("credit")) || {};
    let currentPage = 1;
    const perPage = 50;
    let isAdmin = false;

    function initYearOptions() {
      const now = new Date();
      for (let y = now.getFullYear(); y <= now.getFullYear() + 10; y++) {
        const opt = document.createElement("option");
        opt.value = y;
        opt.text = y + " å¹´";
        yearSelect.appendChild(opt);
      }
      yearSelect.value = now.getFullYear();
    }

    function initMonthOptions() {
      const now = new Date();
      for (let i = 1; i <= 12; i++) {
        const opt = document.createElement("option");
        opt.value = String(i).padStart(2, "0");
        opt.text = i + " æœˆ";
        monthSelect.appendChild(opt);
      }
      monthSelect.value = String(now.getMonth() + 1).padStart(2, "0");
    }

    function getSelectedKey() {
      return yearSelect.value + "-" + monthSelect.value;
    }

    function updateHeaders() {
      const date = new Date(getSelectedKey() + "-01");
      const sundays = [];
      while (date.getMonth() === new Date(getSelectedKey()).getMonth()) {
        if (date.getDay() === 0) sundays.push(date.getDate());
        date.setDate(date.getDate() + 1);
      }
      for (let i = 0; i < 5; i++) {
        document.getElementById("d" + (i + 1)).innerHTML = `ç¬¬${i + 1}é€±æ—¥<br>${sundays[i] || "-"}`;
      }
    }

    function addStudent() {
      const name = studentInput.value.trim();
      if (!name || students.includes(name)) return;
      if (name === "æ‰¿æ™¨èªæ¸") {
        isAdmin = true;
        clearBtn.style.display = "inline-block";
        exitBtn.style.display = "inline-block";
        document.getElementById("delCol").style.display = "";
        renderTable();
        studentInput.value = "";
        return;
      }
      students.push(name);
      localStorage.setItem("students", JSON.stringify(students));
      studentInput.value = "";
      renderTable();
    }

    function clearAll() {
      if (!confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰å­¸ç”Ÿè³‡æ–™ï¼Ÿ")) return;
      students = [];
      localStorage.removeItem("students");
      localStorage.removeItem("records");
      localStorage.removeItem("credit");
      location.reload();
    }

    function exitAdmin() {
      isAdmin = false;
      clearBtn.style.display = "none";
      exitBtn.style.display = "none";
      document.getElementById("delCol").style.display = "none";
      renderTable();
    }

    function toggleSign(name, week) {
      const key = getSelectedKey();
      if (!records[key]) records[key] = {};
      if (!records[key][name]) records[key][name] = [false, false, false, false, false];
      records[key][name][week] = !records[key][name][week];
      localStorage.setItem("records", JSON.stringify(records));
      renderTable();
    }

    function addCredit(name) {
      creditMap[name] = (creditMap[name] || 0) + 5;
      localStorage.setItem("credit", JSON.stringify(creditMap));
      renderTable();
    }

    function getTotalSigned(name) {
      let total = 0;
      for (const month in records) {
        if (records[month][name]) {
          total += records[month][name].filter(v => v).length;
        }
      }
      return total;
    }

    function deleteOne(name) {
      if (!confirm("åˆªé™¤å­¸ç”Ÿï¼š" + name + "ï¼Ÿ")) return;
      students = students.filter(n => n !== name);
      delete creditMap[name];
      for (const key in records) {
        delete records[key][name];
      }
      localStorage.setItem("students", JSON.stringify(students));
      localStorage.setItem("records", JSON.stringify(records));
      localStorage.setItem("credit", JSON.stringify(creditMap));
      renderTable();
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    }

    function nextPage() {
      if (currentPage < Math.ceil(students.length / perPage)) {
        currentPage++;
        renderTable();
      }
    }

    function renderTable() {
      updateHeaders();
      const key = getSelectedKey();
      const thisMonth = records[key] || {};
      const totalPage = Math.ceil(students.length / perPage);
      const pageStudents = students.slice((currentPage - 1) * perPage, currentPage * perPage);
      pageInfo.textContent = `ç¬¬ ${currentPage} / ${totalPage || 1} é `;
      totalCountEl.textContent = `å…± ${students.length} ä½å­¸ç”Ÿ`;
      tableBody.innerHTML = "";

      pageStudents.forEach((name, idx) => {
        const row = document.createElement("tr");
        const tdName = document.createElement("td");
        tdName.innerHTML = `${(currentPage - 1) * perPage + idx + 1}. ${name}`;
        row.appendChild(tdName);

        for (let i = 0; i < 5; i++) {
          const td = document.createElement("td");
          const btn = document.createElement("button");
          const signedIn = thisMonth[name]?.[i];
          btn.textContent = signedIn ? "âœ”ï¸" : "ç°½åˆ°";
          if (signedIn) btn.classList.add("signed");
          btn.onclick = () => toggleSign(name, i);
          td.appendChild(btn);
          row.appendChild(td);
        }

        const tdAdd = document.createElement("td");
        const addBtn = document.createElement("button");
        addBtn.textContent = "ç¹³è²»";
        addBtn.onclick = () => addCredit(name);
        tdAdd.appendChild(addBtn);
        row.appendChild(tdAdd);

        const tdRemaining = document.createElement("td");
        const credit = creditMap[name] || 0;
        const signed = getTotalSigned(name);
        const remaining = credit - signed;
        tdRemaining.innerHTML = remaining <= 1 ? `${remaining}<br>ã€æé†’ç¹³è²»ã€‘` : remaining;
        if (remaining <= 1) tdRemaining.classList.add("warning");
        row.appendChild(tdRemaining);

        const tdTotalSigned = document.createElement("td");
        tdTotalSigned.textContent = signed;
        row.appendChild(tdTotalSigned);

        const tdDel = document.createElement("td");
        if (isAdmin) {
          const delBtn = document.createElement("button");
          delBtn.textContent = "åˆªé™¤";
          delBtn.className = "delete-btn";
          delBtn.onclick = () => deleteOne(name);
          tdDel.appendChild(delBtn);
        }
        tdDel.style.display = isAdmin ? "" : "none";
        row.appendChild(tdDel);

        tableBody.appendChild(row);
      });
    }

    yearSelect.addEventListener("change", renderTable);
    monthSelect.addEventListener("change", renderTable);
    initYearOptions();
    initMonthOptions();
    renderTable();
  </script>
</body>
</html>
